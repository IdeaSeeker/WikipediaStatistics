# WikipediaStatistics
Многопоточная программа для подсчёта различной статистики о статьях русской Википедии (~ 8 млн страниц)

## Статистика

Русскими будем считать слова, состоящие из трёх и более русских букв. Всё остальное - разделители.  
При сборе статистики слова сравниваем без учёта регистра, а разные формы слова считаем разными словами.  

- Топ-300 русских слов наиболее часто встречающихся в названиях статей
```
Топ-300 слов в заголовках статей:
<Число вхождений> <Слово>
...
```

- Топ-300 русских слов наиболее часто встречающихся в самих статьях
```
Топ-300 слов в статьях:
<Число вхождений> <Слово>
...
```

- Распределение статей по размеру
```
Распределение статей по размеру:
0 <Количество статей размером 0-9 байт>
1 <Количество статей размером 10-99 байт>
2 <Количество статей размером 100-999 байт>
...
```

- Распределение статей по времени
```
Распределение статей по времени:
<год> <Количество статей в году>
...
```

### Пример

Статья (в виде xml-файла) на входе:

``` (xml)
<mediawiki xml:lang="ru">
    <page>
        <title>Простой заголовок</title>
        <revision>
            <timestamp>2012-12-12T12:12:12Z</timestamp>
            <text bytes="26">Простой текст</text>
        </revision>
    </page>
</mediawiki>
```

Результат:

```
Топ-300 слов в заголовках статей:
1 заголовок
1 простой

Топ-300 слов в статьях:
1 простой
1 текст

Распределение статей по размеру:
1 1

Распределение статей по времени:
2012 1
```

## Запуск

Программа ожидает на вход аргументы командной строки:
- `--inputs` - один или несколько bzip2-файлов, разделённых запятыми 
- `--output` - файл, куда программа будет записывать отчёт со статистикой
- `--threads` - заданное число потоков для работы

### Пример

Если мы хотим обработать 2 архива: `test_1.bz2` и `test_2.bz2`, при этом задействовав 4 потока, 
и записать результат в файл `statistics.txt`, то нужно передать следующие аргументы (обратите внимание на отсутствие пробелов):   
```
--inputs=test_1.bz2,test_2.bz2 --output=statistics.txt --threads=4
```

## Подробности реализации 

- Распаковка архивов - [7-zip](https://mvnrepository.com/artifact/net.sf.sevenzipjbinding/sevenzipjbinding-all-platforms)

- Обработака xml-файлов - [SAX-Parser](https://docs.oracle.com/javase/7/docs/api/javax/xml/parsers/SAXParser.html)

- Тестирование логики - [JUint5](https://junit.org/junit5/)  
  Для unit-тестов необходим набор файлов `src/test/resources/test_data`  

<!--  
### Известные проблемы

- При запуске тестов на Windows могут возникнуть проблемы `\n`, отчего не все тесты будут пройдены. Возможные решения: 

  - Костыль: заменить `\n` на `${13.toChar()}${10.toChar()}` в 
    [этой строке](https://github.com/IdeaSeeker/WikipediaStatistics/blob/bef2786a83beb3731776886f99e5475be25c95b9/src/main/kotlin/handler/SaxHandler.kt#L75)

  - Магия: Скопировать папку с ресурсами в другое место, удалив её из репозитория, а затем скопировать обратно
-->


## Исходные данные

Статьи википедии хранятся в виде сжатых xml-дампов, которые доступны по [ссылке](https://dumps.wikimedia.org/ruwiki/)  
В качестве примера входных данных взяты дампы из папки `20201101`:  
```
https://dumps.wikimedia.org/ruwiki/20201101/ruwiki-20201101-pages-meta-current1.xml-p1p224167.bz2
https://dumps.wikimedia.org/ruwiki/20201101/ruwiki-20201101-pages-meta-current2.xml-p224168p1042043.bz2
https://dumps.wikimedia.org/ruwiki/20201101/ruwiki-20201101-pages-meta-current3.xml-p1042044p2198269.bz2
https://dumps.wikimedia.org/ruwiki/20201101/ruwiki-20201101-pages-meta-current4.xml-p2198270p3698269.bz2
https://dumps.wikimedia.org/ruwiki/20201101/ruwiki-20201101-pages-meta-current4.xml-p3698270p3835772.bz2
https://dumps.wikimedia.org/ruwiki/20201101/ruwiki-20201101-pages-meta-current5.xml-p3835773p5335772.bz2
https://dumps.wikimedia.org/ruwiki/20201101/ruwiki-20201101-pages-meta-current5.xml-p5335773p6585765.bz2
https://dumps.wikimedia.org/ruwiki/20201101/ruwiki-20201101-pages-meta-current6.xml-p6585766p8085765.bz2
https://dumps.wikimedia.org/ruwiki/20201101/ruwiki-20201101-pages-meta-current6.xml-p8085766p8560833.bz2
```
Результат работы программы на этих архивах доступен в файле `statistics-2020-11-01.txt`


<p align="right"> <i>Проект по Kotlin, МКН СПбГУ, 2 курс, осень 2020</i> </p>
